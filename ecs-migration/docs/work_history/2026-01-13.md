# 작업 이력 - 2026-01-13

## 09:00 - ECS Fargate 마이그레이션 코드 구현

### 변경 사항

#### 1. 디렉토리 구조 생성

- 변경된 파일: `ecs-migration/` 전체 구조
- 변경 내용:
  - `dockerfiles/` - 6개 컴포넌트 Dockerfile
  - `task-definitions/` - ECS Task Definition JSON
  - `terraform/` - Terraform IaC 모듈
  - `.github/workflows/` - GitHub Actions CI/CD
  - `scripts/` - 빌드 및 배포 스크립트
- 이유: 기존 docker-compose 기반 구성을 ECS Fargate로 마이그레이션하기 위한 코드베이스 구축

---

## 09:30 - Dockerfile 작성 (6개 컴포넌트)

### 변경 사항

- 변경된 파일:
  - `dockerfiles/mimir/Dockerfile`
  - `dockerfiles/mimir/config/mimir-config.yaml`
  - `dockerfiles/loki/Dockerfile`
  - `dockerfiles/loki/config/loki-config.yaml`
  - `dockerfiles/tempo/Dockerfile`
  - `dockerfiles/tempo/config/tempo-config.yaml`
  - `dockerfiles/pyroscope/Dockerfile`
  - `dockerfiles/pyroscope/config/pyroscope-config.yaml`
  - `dockerfiles/grafana/Dockerfile`
  - `dockerfiles/grafana/config/provisioning/datasources/datasources.yaml`
  - `dockerfiles/alloy/Dockerfile`
  - `dockerfiles/alloy/config.d/cloudwatch.alloy`

- 변경 내용:
  - 기존 docker-compose 설정 기반 Dockerfile 작성
  - Tini init 시스템 추가 (Graceful Shutdown)
  - Health check 설정
  - ECS Fargate 환경에 맞는 설정 적용
  - CloudMap Service Discovery 연동 설정

- 이유:
  - ECS Fargate에서 컨테이너 실행을 위한 이미지 빌드
  - 기존 EC2 docker-compose 설정과의 호환성 유지

### 영향도

- 영향받는 컴포넌트: Mimir, Loki, Tempo, Pyroscope, Grafana, Alloy
- 주의사항:
  - Mimir/Loki memberlist 설정에서 CloudMap DNS 사용
  - Grafana datasource에서 CloudMap 엔드포인트 사용

---

## 10:00 - ECS Task Definition JSON 작성

### 변경 사항

- 변경된 파일:
  - `task-definitions/mimir.json`
  - `task-definitions/loki.json`
  - `task-definitions/tempo.json`
  - `task-definitions/pyroscope.json`
  - `task-definitions/grafana.json`
  - `task-definitions/alloy.json`

- 변경 내용:
  - 6개 컴포넌트별 Task Definition 작성
  - CloudWatch Logs 설정
  - Health check 설정
  - stopTimeout 120초 설정 (Graceful Shutdown)
  - Secrets Manager 연동 (Grafana 비밀번호)

- 이유: ECS Service 생성을 위한 Task Definition 정의

### 영향도

- 영향받는 컴포넌트: ECS 전체 서비스
- 주의사항: `${AWS_ACCOUNT_ID}` 플레이스홀더를 실제 계정 ID로 교체 필요

---

## 10:30 - Terraform 인프라 코드 작성

### 변경 사항

- 변경된 파일:
  - `terraform/environments/prod/main.tf`
  - `terraform/environments/prod/variables.tf`
  - `terraform/environments/prod/terraform.tfvars.example`
  - `terraform/modules/ecr/main.tf`
  - `terraform/modules/iam/main.tf`
  - `terraform/modules/security-groups/main.tf`
  - `terraform/modules/cloudmap/main.tf`
  - `terraform/modules/alb/main.tf`
  - `terraform/modules/ecs/main.tf`

- 변경 내용:
  - 모듈화된 Terraform 코드 작성
  - ECR 리포지토리 6개
  - IAM Role (Task Execution, Task Role별)
  - Security Groups (ALB, ECS)
  - CloudMap Service Discovery
  - Application Load Balancer
  - ECS Cluster 및 Services

- 이유: 인프라를 코드로 관리하여 재현성 및 버전 관리 확보

### 영향도

- 영향받는 컴포넌트: AWS 인프라 전체
- 주의사항:
  - VPC, Subnet이 사전에 존재해야 함
  - ACM 인증서 ARN 필요
  - terraform.tfvars 파일 설정 필요

---

## 11:00 - GitHub Actions CI/CD Pipeline 작성

### 변경 사항

- 변경된 파일:
  - `.github/workflows/deploy-ecs.yaml`
  - `.github/workflows/terraform.yaml`
  - `.github/workflows/build-only.yaml`

- 변경 내용:
  - ECS 배포 워크플로우 (빌드, 푸시, 배포, 헬스체크)
  - Terraform 워크플로우 (plan, apply, destroy)
  - PR용 빌드 테스트 워크플로우
  - OIDC 기반 AWS 인증
  - Matrix 빌드로 6개 컴포넌트 병렬 처리

- 이유: Jenkins 대신 GitHub Actions 사용 (사용자 요청)

### 영향도

- 영향받는 컴포넌트: CI/CD 파이프라인
- 주의사항:
  - GitHub Secrets 설정 필요 (AWS_ROLE_ARN)
  - AWS IAM OIDC Provider 설정 필요

---

## 11:30 - 빌드 및 배포 스크립트 작성

### 변경 사항

- 변경된 파일:
  - `scripts/build-all.sh`
  - `scripts/deploy-ecs.sh`
  - `scripts/setup-infrastructure.sh`

- 변경 내용:
  - 전체 이미지 빌드 스크립트
  - ECS 배포 스크립트
  - 인프라 초기 설정 스크립트 (ECR, Log Groups, Secrets)

- 이유: 수동 배포 및 로컬 테스트용 스크립트

### 영향도

- 영향받는 컴포넌트: 로컬 개발 환경
- 주의사항: AWS CLI 및 Docker 설치 필요

---

## 12:00 - 문서 업데이트

### 변경 사항

- 변경된 파일:
  - `ecs-migration/README.md`
  - `ecs-migration/docs/work_history/2026-01-13.md`

- 변경 내용:
  - README.md 전체 업데이트 (GitHub Actions 반영)
  - 작업 이력 작성

- 이유: 문서와 코드의 동기화

---

## 요약

### 생성된 파일 목록

```text
ecs-migration/
├── dockerfiles/
│   ├── mimir/
│   │   ├── Dockerfile
│   │   └── config/mimir-config.yaml
│   ├── loki/
│   │   ├── Dockerfile
│   │   └── config/loki-config.yaml
│   ├── tempo/
│   │   ├── Dockerfile
│   │   └── config/tempo-config.yaml
│   ├── pyroscope/
│   │   ├── Dockerfile
│   │   └── config/pyroscope-config.yaml
│   ├── grafana/
│   │   ├── Dockerfile
│   │   └── config/provisioning/datasources/datasources.yaml
│   └── alloy/
│       ├── Dockerfile
│       └── config.d/cloudwatch.alloy
├── task-definitions/
│   ├── mimir.json
│   ├── loki.json
│   ├── tempo.json
│   ├── pyroscope.json
│   ├── grafana.json
│   └── alloy.json
├── terraform/
│   ├── modules/
│   │   ├── ecr/main.tf
│   │   ├── iam/main.tf
│   │   ├── security-groups/main.tf
│   │   ├── cloudmap/main.tf
│   │   ├── alb/main.tf
│   │   └── ecs/main.tf
│   └── environments/prod/
│       ├── main.tf
│       ├── variables.tf
│       └── terraform.tfvars.example
├── .github/workflows/
│   ├── deploy-ecs.yaml
│   ├── terraform.yaml
│   └── build-only.yaml
├── scripts/
│   ├── build-all.sh
│   ├── deploy-ecs.sh
│   └── setup-infrastructure.sh
└── README.md (업데이트)
```

### 다음 단계

1. AWS IAM OIDC Provider 설정 (GitHub Actions용)
2. terraform.tfvars 파일 작성
3. Terraform 실행하여 인프라 생성
4. Docker 이미지 빌드 및 테스트
5. ECS 서비스 배포 및 검증

---

---

## 13:00 - Jenkins 참조 제거 및 GitHub Actions로 변경

### 변경 사항

- 변경된 파일:
  - `ecs-migration/docs/migration-plan.md`
  - `CLAUDE.md`

- 변경 내용:
  - Phase 6 "Jenkins CI/CD 구축" → "GitHub Actions CI/CD 구축"으로 변경
  - Jenkins 관련 Plugin, Credentials 설명 → GitHub Actions Workflow, Secrets 설명으로 변경
  - AWS IAM OIDC Provider 설정 가이드 추가
  - 팀 교육 항목에서 Jenkins → GitHub Actions로 변경
  - 운영 지표 CI/CD 파이프라인 항목 변경
  - CLAUDE.md ECS Migration 섹션 업데이트 (코드 구조, CI/CD 설명 추가)

- 이유: 사용자 요청에 따라 Jenkins 대신 GitHub Actions 사용

### 영향도

- 영향받는 컴포넌트: CI/CD 파이프라인, 문서
- 주의사항: 기존 jenkins_docker 폴더는 다른 프로젝트용으로 별도 유지

---

**작성일:** 2026-01-13
**작성자:** Claude Opus 4.5
**프로젝트:** LGTM_PRD ECS Fargate Migration
